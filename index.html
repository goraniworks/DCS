<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket 테스트</title>
    <style>
        /* body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #panel {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .gauge {
            width: 100px;
            height: 100px;
            margin: 10px;
            position: relative; 
        }
        .info {
            text-align: center; 
            margin-top: 5px;          
        }
        #messages {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            min-height: 50px;
        }  */

        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #panel {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .gauge-container {
            position: relative; /* 컨테이너를 relative로 설정 */
            width: 100px;
            height: 100px;
        }
        .gauge {
            position: absolute; /* gauge를 절대위치로 설정하여 겹칠 수 있도록 함 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .background-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* 이미지를 삼각형 뒤로 보내기 */
        }
        .info {
            text-align: center;
            position: absolute;
            width: 100%;
            bottom: -20px; /* 정보 표시 위치 조정 */
        }
        #messages {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            min-height: 50px;
        }        
    </style>
</head>
<body>
    <h1>WebSocket을 통한 서버 데이터 수신</h1>
    <div id="panel">
        <!-- <div class="gauge-container">
            <svg id="ias" class="gauge" viewBox="0 0 100 100"><polygon points="50,30 30,70 70,70" fill="red" /></svg>
            <div id="ias-info" class="info"></div>
        </div> -->
        <div class="gauge-container">
            <img src="circle.png" class="background-image">
            <svg id="ias" class="gauge" viewBox="0 0 100 100"><polygon points="50,30 30,70 70,70" fill="red" /></svg>
            <div id="ias-info" class="info"></div>
        </div>
        <svg id="altBar" class="gauge" viewBox="0 0 100 100"><polygon points="50,30 30,70 70,70" fill="green" /></svg>
        <svg id="alrRad" class="gauge" viewBox="0 0 100 100"><polygon points="50,30 30,70 70,70" fill="blue" /></svg>
        <svg id="pitch" class="gauge" viewBox="0 0 100 100"><polygon points="50,30 30,70 70,70" fill="purple" /></svg>
        <svg id="bank" class="gauge" viewBox="0 0 100 100"><polygon points="50,30 30,70 70,70" fill="orange" /></svg>
        <svg id="yaw" class="gauge" viewBox="0 0 100 100"><polygon points="50,30 30,70 70,70" fill="cyan" /></svg>
    </div>
    <div id="messages"></div>
    <script>
        const messages = document.getElementById('messages');
        const ws = new WebSocket('ws://localhost:15348');

        ws.onopen = function() {
            console.log('서버에 연결되었습니다.');
            messages.textContent = '서버에 연결되었습니다...';
        };

        ws.onmessage = function(event) {
            console.log('서버로부터 메시지 수신:', event.data);
            const data = event.data;
            const parts = data.split(', ').map(part => {
                const pair = part.split(' = ');
                return {key: pair[0], value: parseFloat(pair[1])};
            });
            const dataMap = Object.fromEntries(parts.map(part => [part.key, part.value]));

            updateGauges(dataMap);
        };

        ws.onerror = function(error) {
            console.log('WebSocket 오류:', error);
            messages.textContent = 'WebSocket 연결 오류 발생!';
        };

        ws.onclose = function() {
            console.log('서버와의 연결이 종료되었습니다.');
            messages.textContent += '\n서버와의 연결이 종료되었습니다.';
        };

        function updateGauges(data) {
            // IAS 값에 따라 각도를 계산
            const iasAngle = (30/28) * data.IAS; 

            document.getElementById('ias').style.transform = `rotate(${iasAngle}deg)`;
            document.getElementById('ias-info').textContent = `IAS: ${data.IAS}, 각도: ${iasAngle.toFixed(2)}°`;
            // document.getElementById('ias').style.transform = `rotate(${data.IAS}deg)`;
            document.getElementById('altBar').style.transform = `rotate(${data.altBar * 360}deg)`;
            document.getElementById('alrRad').style.transform = `rotate(${data.alrRad * 6}deg)`;
            document.getElementById('pitch').style.transform = `rotate(${data.pitch * 180}deg)`;
            document.getElementById('bank').style.transform = `rotate(${data.bank * 180}deg)`;
            document.getElementById('yaw').style.transform = `rotate(${data.yaw * 360}deg)`;
        }
    </script>
</body>
</html>
